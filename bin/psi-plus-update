#!/bin/sh

if [ -d psi ]; then
	echo psi dir already exists
	exit 0
fi

mkdir psi
cd psi

svn co http://psi-dev.googlecode.com/svn/trunk/ psi-dev
rev=`svnversion psi-dev/patches`
psi_rev=psi+-0.15.$rev
find psi-dev -name .svn -exec rm -rf {} +

git clone --depth 1 git://git.psi-im.org/psi.git $psi_rev
cd $psi_rev
git submodule init
git submodule update
find . -name '.git*' -exec rm -rf {} +

for f in ../psi-dev/patches/*diff; do
	patch --no-backup-if-mismatch -p1 -i "${f}"
done

psi_rev=psi+-0.15.3817
cd $psi_rev

cp -r ../psi-dev/iconsets/ ./
cp -r ../psi-dev/plugins/ src/

qconf

cd ..

tar jcf $psi_rev.tar.bz2 $psi_rev/
